!function(e){var t,o;window.jQuery?e(window.csdn=window.csdn||{},void 0):window.jQuery||(t=document.createElement("script"),o=document.getElementById("collection-script")||document.head.lastElementChild||document.head.lastChild,t.src="//csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js",t.type="text/javascript",myDOM=o.previousElementSibling||o.previousSibling,t.onload=function(){e(window.csdn=window.csdn||{},void 0)},document.body.insertBefore(t,o))}(function(C,o){var m=window.jQuery||{},e=o,t=o,L=window.document,l="1.0.0",f={baseUrl:"//g.csdnimg.cn/collection-box/",userTag:"UserName",ads:"//g.csdnimg.cn/collection-box/1.0.0/collection-box.css",collectionTag:"[data-bind-collection=true]",prefixStyleTag:"g-",styleTag:"collection-box",status:{create:"add-collection",list:"list-collection"},requestHostName:"//me.csdn.net",messageInfoTimer:1800};C.collectionBox=C.collectionBox?C.collectionBox:{},m===window.jQuery?(t=function(e,t){var o=[];return m(t,e).each(function(e,t){o.push(t)}),o},e=!0):t=function(e){return L.querySelectorAll(e)},m.COLLECTION={version:l,v:"1.0.0"},m.COLLECTION.labels={currentTab:"add-collection"},C.collectionBox.params&&r(C.collectionBox.params),C.collectionBox.scope=m.COLLECTION;function n(n){var c=document.cookie;return c&&function(){for(var e,t={},o=0,l=(c=c.split("; ")).length;o<l&&!(0<(e=c[o].split("=")).length&&(e[0]===n&&(t.key=e[0],t.value=e[1],t.status=!0),"key"in t));o++);return"key"in t&&t}()}function O(e){return e.replace(/^\s*/g,"").replace(/\s*$/g,"")}function g(e,t,o){window.addEventListener?e.addEventListener(t,o,!1):e.attachEvent("on"+t,o)}function c(e,t,o){window.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent("on"+t,o)}function r(e){function t(e){if(e?"url"in e&&""!==e.url?"source"in e&&""!==e.source?"source_id"in e&&""!==e.source_id?"author"in e&&""!==e.author?"title"in e&&""!==e.title||(console.warn("调用请提供标题信息"),o=!1):(console.warn("调用请提供访问用户作者信息"),o=!1):(console.warn("调用请提供访问来源source_id！"),o=!1):(console.warn("调用请提供访问来源类型！"),o=!1):(console.warn("调用请提供访问来源地址！"),o=!1):(console.warn("调用请提供访问需设参数！"),o=!1),!1===o)return!1}var o=!0;if(m.COLLECTION.params||t(e),m.COLLECTION.params){if(e&&o){for(var l in e)m.COLLECTION.params[l]=e[l];t(m.COLLECTION.params)}}else o&&(m.COLLECTION.params=e);return o}function p(e){for(var t,o,l=0,n="";t=e[l];)n+='<li><span class="title"><a href="###">'+(o=t).Name+'</a></span><em class="info"><i>'+o.FavoriteNum+'</i>条内容</em><a href="" class="btn-collect btn-collect-pos '+(0<o.CheckStatus?"btn-uncollected":"btn-collected")+'" data-id="'+o.ID+'" name="collection-btn"'+(0<o.CheckStatus?"data-checkId="+o.CheckStatus:"")+">"+(0<o.CheckStatus?"已收藏":"收藏")+"</a></li>",l++;return n}function v(e){var t=m(m.COLLECTION.gMessage);t.text(e),t.addClass("g-fadeInDown"),setTimeout(function(){t.removeClass("g-fadeInDown")},f.messageInfoTimer)}function i(){var t={};function s(e){var t,o=0,l=!1,n=e.pos,c=e.msg;if(!n)return!1;if(r=c&&function(e){var t,o,l=e.msg,n=e.pos;return n&&!n.isCreate?((o=L.createElement("div")).className="g-collection-error",o.innerHTML=l,n.isCreate=!0,o):((t=n.querySelector(".g-collection-error"))&&(t.innerHTML=l),t)}(e)){for(n.appendChild(r),n.eleTag=r;t=m.COLLECTION.formError[0];){if(t===n){l=!0;break}o++}l||m.COLLECTION.formError.push(n)}else{var r;if((r=n.querySelector(".g-collection-error")||m(".g-collection-error",n).get(0))&&!c)for(n.removeChild(r),delete n.eleTag,delete n.isCreate;t=m.COLLECTION.formError[o];){if(t===n){m.COLLECTION.formError.splice(o,1);break}o++}}}m.COLLECTION.formError=[];var o,l,n,u,e,c,r,d={title:{reg:"([^\\s*]+){2,20}",min:2,max:20,msg:"长度在 2 到 20 个字符"}},i=m.COLLECTION.formGroup,a=m.COLLECTION.formBtns;if(!a||!i)return console.warn("collection option is fail!"),!1;o=i.querySelector(".form-title")||m("#g-form-title",i).get(0),l=i.querySelector(".form-des")||m("#g-form-des",i).get(0),n=i.querySelector(".form-check")||m("#g-form-checks",i).get(0),u=a.querySelector(".btn-confirm")||m("#g-btn-confirm",a).get(0),e=a.querySelector(".btn-reset")||m("#g-btn-reset",a).get(0),c=function(e){var t,o,l,n,c=O(e&&e.value||this.value),r=O(e&&e.value||this.value),i=e&&e.getAttribute("data-name")||this.getAttribute("data-name"),a=!0;t=(i=i&&d[i]).reg&&new RegExp(i.reg,"g"),n=i.reg&&i.msg||"格式不正确",o=i.min,l=i.max,t&&(r=(r=r.match(t))&&r[0]),r?(o||l)&&(c.length<o||c.length>l)&&(a=!1):a=!1,!1===a?u.isNoSub=!0:delete u.isNoSub,s(!1===a?{msg:n,pos:this.parentNode}:{pos:this.parentNode})},r=function(){var e=n.getElementsByTagName("input");if(t.name=O(o.value),t.description=O(l.value),t.source=m.COLLECTION.params.source,t.is_private=0<e.length&&(e[0].checked?0:1),!m.ajax)return console.warn("请导入jquery, 发起请求"),!1;m.ajax({type:"post",url:f.requestHostName+"/api/favorite/createFolder",data:JSON.stringify(t),crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){if(200===e.code){var t=e.data,o=p([t]);v("创建成功!"),N(o,"single"),C.collectionBox.getState(null,"list"),T()}},error:function(t){var o;if(t){try{o=JSON.parse(t.responseText).message}catch(e){o=t.statusText}v(o||"创建失败!")}}})},o.onblur=function(){c.call(this)},u&&g(u,"click",function(){if(o.focus(),o.blur(),u.isNoSub)return!1;r()}),e&&g(e,"click",function(){C.collectionBox.close()})}function a(e){var t,o,l,n,c,r=f.prefixStyleTag?f.prefixStyleTag:"g-";return o='<div class="g-collection-box g-collection-skin '+f.styleTag+("add-collection"===m.COLLECTION.labels.currentTab?" g-collection":"")+'"><span class="'+r+'close-btn" id="g-close-btn">&times</span><div class="collection-title '+r+'collection-title">添加收藏</div><div class="collection-title '+r+'create-title">新建收藏夹</div><div class="collection-content"><ul class="list '+(e?"":"hide")+'" id="g-collection-list">'+(e||"")+'</ul><div class="collection-blank '+(e?"hide":"")+'"><span class="g-monkey"><img src="'+f.baseUrl+m.COLLECTION.version+'/images/monkey-pixel.svg" alt="no result"></span><em>没有收藏列表内容！</em></div><div class="'+r+'collection-form" id="g-collection-form"><div class="'+r+'form-control"><label class="label-title" for="g-form-title">标题</label><input data-name="title" tabindex="1" class="'+r+'form-control-text form-title" id="g-form-title" placeholder="请填写收藏夹的名称" type="text"/></div><div class="'+r+'form-control"><label class="label-title" for="g-form-des">描述（选填）</label><textarea data-name="des" class="'+r+'form-control-text form-des" id="g-form-des" placeholder="请填写收藏夹的名称" rows="8"></textarea></div><div class="'+r+"form-control "+r+'form-control-private"><label class="label-title">私密</label><span class="check-group form-check" id="g-form-checks"><span><input type="radio" name="radios" id="public-radio" value="0" checked/> <label for="public-radio">公开 所有人可见</label></span><span><input type="radio" name="radios" id="private-radio" value="1"/> <label for="private-radio">私密 只有你可以查看这个收藏夹</label></span></span></div></div></div><div class="'+r+'btn-group" id="g-btn-group"><a href="javascript:void(0);" class="btn-add-collection '+r+'btn" onclick="window.csdn.collectionBox.getState(this, \'create\');">+ 新建收藏夹</a><a href="javascript:void(0);" id="g-btn-back" class="btn-back '+r+'btn" onclick="window.csdn.collectionBox.getState(this, \'list\');">返回</a><a href="javascript:void(0);" id="g-btn-reset" class="btn-reset '+r+'btn">取消</a><a href="javascript:void(0);" id="g-btn-confirm" class="btn-confirm '+r+'btn">确定</a></div></div>',l=L.body,n=L.createDocumentFragment(),(c=L.createElement("div")).className="g-collection-mark",c.innerHTML=o+'<span class="g-collection-message" id="g-collection-message"></span>',m.COLLECTION.fragmentDom=n,m.COLLECTION.htmlDom=c,m.COLLECTION.collectionDom=c.firstElementChild||c.firstChild,m.COLLECTION.closeBtn=m.COLLECTION.collectionDom.querySelector("."+r+"close-btn")||m.COLLECTION.collectionDom.children[0],m.COLLECTION.collectionList=m.COLLECTION.collectionDom.querySelector(".list")||m("#g-collection-list",m.COLLECTION.collectionDom).get(0),m.COLLECTION.formGroup=m.COLLECTION.collectionDom.querySelector("."+r+"collection-form")||m("#g-collection-form",m.COLLECTION.collectionDom).get(0),m.COLLECTION.formBtns=m.COLLECTION.collectionDom.querySelector("."+r+"btn-group")||m("#g-btn-group",m.COLLECTION.collectionDom).get(0),m.COLLECTION.gMessage=c.lastElementChild||c.lastChild,m.COLLECTION.collectionDom.isCreate=!0,n.appendChild(c),t=l.appendChild(n),i(),t}function s(l,n){var e=m.COLLECTION.params.url;m.ajax({type:"get",url:f.requestHostName+"/api/favorite/folderListWithCheck?url="+e,crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){var t,o;200===e.code&&e.data&&(t=e.data.result,o=p(t),!m.COLLECTION.collectionDom||m.COLLECTION.collectionDom&&!m.COLLECTION.collectionDom.isCreate?l(o):N(o),n())},error:function(t){var o;if(t){try{o=JSON.parse(t.responseText).message}catch(e){o=t.statusText}v(o||"获取收藏列表失败!")}}})}function u(e,t){var o;return o="all"===e?"none":"block","start"===e&&(o="block"),m.COLLECTION.collectionDom&&(m.COLLECTION.collectionDom.parentNode.style.display=o,m.COLLECTION.collectionDom.status="block"===o||!(m.COLLECTION.runStatus=!0)),m.COLLECTION.collectionDom.status&&t&&t(),m.COLLECTION}function d(e){var t=(!m.COLLECTION.collectionDom||m.COLLECTION.collectionDom&&!m.COLLECTION.collectionDom.isCreate)&&!m.COLLECTION.linkCss&&function(){var e,t=L.head,o=t.firstElementChild||t.firstChild,l=L.createElement("link");return l.rel="stylesheet",l.type="text/css",l.href=f.ads,e=t.insertBefore(l,o),!!(m.COLLECTION.linkCss=e)}();if(!1===r(e))return console.warn("调用失败！"),!1;t?s(a,function(){u(o),function(){function e(e){var t=e||window.event;if(m.COLLECTION.collectionDom.status&&t.target===this)return u("all"),E(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),!1}m.COLLECTION.collectionDom.parentNode&&!m.COLLECTION.collectionDom.parentNode.isClick&&(c(m.COLLECTION.collectionDom.parentNode,"click",e),g(m.COLLECTION.collectionDom.parentNode,"click",e),m.COLLECTION.collectionDom.parentNode.isClick=!0),m.COLLECTION.closeBtn&&!m.COLLECTION.closeBtn.isCloseClick&&(c(m.COLLECTION.closeBtn,"click",e),g(m.COLLECTION.closeBtn,"click",e),m.COLLECTION.closeBtn.isCloseClick=!0)}(),T()}):m.COLLECTION.collectionDom&&s(N,function(){u(o),T()})}var E=C.collectionBox.getState=function(e,t){return"list"===(t=t||"list")&&function(){var e,t=m.COLLECTION.formGroup,o=t.querySelector(".form-title")||L.getElementById("g-form-title"),l=t.querySelector(".form-des")||L.getElementById("g-form-des"),n=t.querySelector(".form-check")||L.getElementById("g-form-checks");if(o.value&&(o.value=""),l.value&&(l.value=""),n){var c=n.getElementsByTagName("input");c&&(c[0].checked=!0)}if(0<m.COLLECTION.formError.length)for(;e=m.COLLECTION.formError.shift();)e.eleTag&&delete e.isCreate&&e.removeChild(e.eleTag)}(),m.COLLECTION.labels.currentTab=f.status[t],function(e){var t,o;"add-collection"===(e=e||m.COLLECTION.labels.currentTab)?(t=new RegExp("(s*g-collection([^-]|$))","g"),o=" g-create"):"list-collection"===e&&(t=new RegExp("(s*g-create([^-]|$))","g"),o=" g-collection"),m.COLLECTION.collectionDom.className=m.COLLECTION.collectionDom.className.replace(t,o)}(),C.collectionBox},T=function(){var c;m(".btn-collect","#g-collection-list").off("click"),m(".btn-collect","#g-collection-list").on("click",function(e){var t={},l=m(this),o=Number(m(this).attr("data-id"),10),n=Number(m(this).attr("data-checkId"),10);if(m(this).hasClass("btn-collected")){if(c=f.requestHostName+"/api/favorite/create",!(m.COLLECTION.params.url&&m.COLLECTION.params.title&&m.COLLECTION.params.author&&m.COLLECTION.params.source&&m.COLLECTION.params.source_id))return alert("缺少提交参数!"),!1;t.url=m.COLLECTION.params.url,t.title=m.COLLECTION.params.title,t.description=m.COLLECTION.params.description||"",t.author=m.COLLECTION.params.author,t.source=m.COLLECTION.params.source,t.source_id=Number(m.COLLECTION.params.source_id,10),t.folder_id=o,l.isCollect=!0}else if(m(this).hasClass("btn-uncollected")){if(c=f.requestHostName+"/api/favorite/delete",!m.COLLECTION.params.source)return alert("缺少提交参数!"),!1;t.source=m.COLLECTION.params.source,n&&(t.ids=[n]),l.isCollect=!1}return m.ajax({type:"post",url:c,data:JSON.stringify(t),crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){var t=l.closest("li").find(".info i"),o=Number(t.html(),10)||0;200===e.code&&(l.isCollect?(l.attr("data-checkId",e.data.ID).removeClass("btn-collected").addClass("btn-uncollected").text("已收藏"),o+=1):(l.removeAttr("data-checkId").removeClass("btn-uncollected").addClass("btn-collected").text("收藏"),o-=1),t.html(o))},error:function(t){var o;if(t){try{o=JSON.parse(t.responseText).message}catch(e){o=t.statusText}v(o||"操作失败!")}}}),!1})},N=function(e,t){var o,l,n=m.COLLECTION.collectionList;n&&("single"===t?(n.className=n.className.replace(/hide/g,""),(l=L.createElement("ul")).innerHTML=e,l=l.firstElementChild||l.firstChild,o=n.firstElementChild||n.firstChild||null,e&&n.insertBefore(l,o)):e&&(n.innerHTML="",n.innerHTML=e))};C.collectionBox.close=function(){return!m.COLLECTION.collectionDom||m.COLLECTION.collectionDom&&!m.COLLECTION.collectionDom.status||m.COLLECTION.collectionDom.status&&(E(),u("all")),C.collectionBox},C.collectionBox.show=function(e){return d(e),C.collectionBox};function h(){!function(){var l=m(f.collectionTag,L)||t(L,f.collectionTag);e?m(L).on("click",f.collectionTag,function(e){var t=e||window.event;return d(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),t.returnValue?t.returnValue=!1:t.preventDefault(),!1}):0<l.length&&function(){m.COLLECTION.collectionBtns=l;function e(e){var t=e||window.event;d(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),t.returnValue?t.returnValue=!1:t.preventDefault()}for(var t,o=0;l[o];)void 0,t=l[o],g(t,"click",e),o++}()}()}function b(){!function(){if(result=n(f.userTag),!result||result&&!result.status)return;h()}()}function I(e){document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(function(){e&&e()},0):(y=function(){document.removeEventListener("DOMContentLoaded",y,!1),e()},document.addEventListener("DOMContentLoaded",y,!1)):document.attachEvent&&function(e){function t(){o||(o=!0,e&&e())}var o=!1,l=function(){try{L.documentElement.doScroll("left")}catch(e){return void setTimeout(l,50)}t()};l(),L.onreadystatechange=function(){"complete"===L.readyState&&(L.onreadystatechange=null,t())}}(e)}var y;_ready=function(){e&&m(function(){b()})||I(b)},_ready()});